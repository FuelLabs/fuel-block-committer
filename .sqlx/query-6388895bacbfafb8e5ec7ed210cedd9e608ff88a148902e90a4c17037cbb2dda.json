{
  "db_name": "PostgreSQL",
  "query": "\n            WITH\n\n            -- Delete from da_submission\n            deleted_blob_transactions AS (\n                DELETE FROM da_submission\n                WHERE created_at < $1\n                RETURNING id\n            ),\n\n            -- Delete from l1_transaction_fragments\n            deleted_transaction_fragments AS (\n                DELETE FROM l1_transaction_fragments\n                WHERE transaction_id IN (SELECT id FROM deleted_blob_transactions)\n                RETURNING transaction_id\n            ),\n\n            -- Build updated_transaction_fragments that represent the state after deletions\n            updated_transaction_fragments AS (\n                SELECT fragment_id FROM l1_transaction_fragments\n                WHERE transaction_id NOT IN (SELECT transaction_id FROM deleted_transaction_fragments)\n            ),\n\n            -- Delete unreferenced fragments\n            deleted_fragments AS (\n                DELETE FROM l1_fragments\n                WHERE id NOT IN (SELECT fragment_id FROM updated_transaction_fragments)\n                RETURNING id\n            ),\n\n            -- Step 4: Build updated_fragments that represent the state of after deletions\n            updated_fragments AS (\n                SELECT bundle_id FROM l1_fragments\n                WHERE id NOT IN (SELECT id FROM deleted_fragments)\n            ),\n\n            -- Delete unreferenced bundles and collect start and end heights\n            deleted_bundles AS (\n                DELETE FROM bundles\n                WHERE id NOT IN (SELECT bundle_id FROM updated_fragments)\n                RETURNING start_height, end_height\n            ),\n\n            -- Delete unreferenced bundle costs\n            deleted_bundle_costs AS (\n                DELETE FROM bundle_cost\n                WHERE bundle_id NOT IN (SELECT bundle_id FROM updated_fragments)\n            ),\n\n            -- Delete corresponding fuel_blocks entries\n            deleted_fuel_blocks AS (\n                DELETE FROM fuel_blocks\n                WHERE EXISTS (\n                    SELECT 1 FROM deleted_bundles\n                    WHERE fuel_blocks.height BETWEEN deleted_bundles.start_height AND deleted_bundles.end_height\n                )\n            ),\n\n            -- Delete from l1_transaction\n            deleted_transactions AS (\n                DELETE FROM l1_transaction\n                WHERE created_at < $1\n                RETURNING id\n            ),\n\n            -- Build updated_contract transaction that represent the state after deletions\n            updated_transactions AS (\n                SELECT submission_id FROM l1_transaction\n                WHERE id NOT IN (SELECT id FROM deleted_transactions)\n            ),\n\n            -- Delete from l1_fuel_block_submission\n            deleted_submissions AS (\n                DELETE FROM l1_fuel_block_submission\n                WHERE id NOT IN (SELECT submission_id FROM updated_transactions)\n            )\n\n            SELECT;\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Timestamptz"
      ]
    },
    "nullable": []
  },
  "hash": "6388895bacbfafb8e5ec7ed210cedd9e608ff88a148902e90a4c17037cbb2dda"
}
